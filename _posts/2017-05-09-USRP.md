---
layout: post
title:  "软件无线电USRP N210+MATLAB+pem009 MATLAB示例"
date:   2017-06-15 01:38:56
categories: 软件无线电
tags: 软件无线电 USRP MATLAB
---

* content
{:toc}


1. 4.示例

如下是一个用来检测发射、接收成功的matlab小例子：

发射正弦波，并将接收到的信号时域图和频域图显示出来。



		clear all;

		%% usrp必备，用来检测usrp连接成功，并对平台名称什么的赋值

		connectedRadios = findsdru;

		if strncmp(connectedRadios(1).Status, &#39;Success&#39;, 7)

		  radioFound = true;

		  platform = connectedRadios(1).Platform;

		  switch connectedRadios(1).Platform

			case {&#39;B200&#39;,&#39;B210&#39;}

			  address = connectedRadios(1).SerialNum;

			case {&#39;N200/N210/USRP2&#39;,&#39;X300&#39;,&#39;X310&#39;}

			  address = connectedRadios(1).IPAddress;

		  end

		else

		  radioFound = false;

		  address = &#39;192.168.10.2&#39;;

		  platform = &#39;N200/N210/USRP2&#39;;

		end

		%% 对发射器接收器进行定义赋值

		% rfTxFreq = 2.48e9 ;

		rfTxFreq = 467.6625e6;

		rfRxFreq = 467.6625e6; % RF Receiver Center Frequency (Hz)

		% rfRxFreq = 2.48e9 ;

		rfRxFreqCorrection = -4e3; % Frequency calibration compensation value (Hz)

		rfRxFreqActual = rfRxFreq + rfRxFreqCorrection;

		txRadioGain = 5;

		rxRadioGain = 15;

		rxRadioDecimationFactor = 500;

		rxRadioFrameLength = 4000;



		 radioTx = comm.SDRuTransmitter(&#39;Platform&#39;, platform, ...

				&#39;IPAddress&#39;, address, ...

				&#39;CenterFrequency&#39;, rfTxFreq,...

				&#39;Gain&#39;, txRadioGain);

		 radioRx = comm.SDRuReceiver(&#39;Platform&#39;, platform, ...

				&#39;IPAddress&#39;, address, ...

				&#39;CenterFrequency&#39;, rfRxFreq,...

				&#39;Gain&#39;, rxRadioGain, ...

				&#39;DecimationFactor&#39;, rxRadioDecimationFactor, ...

				&#39;SamplesPerFrame&#39;, rxRadioFrameLength, ...

				&#39;OutputDataType&#39;, &#39;single&#39;);



			%% 显示频域范围内的频率强度图显示函数；显示时域信号的波形，本脚本选的是一个正弦波。



			hSpectrumAnalyzer = dsp.SpectrumAnalyzer(...

			&#39;Name&#39;,                &#39;Frequency of the Sine waveform sent out&#39;,...

			&#39;Title&#39;,               &#39;Frequency of the Sine waveform sent out&#39;,...

			&#39;SampleRate&#39;,           200e3, ...

			&#39;YLimits&#39;,              [-150,30],...

			&#39;SpectralAverages&#39;,     50, ...

			&#39;FrequencySpan&#39;,        &#39;Start and stop frequencies&#39;, ...

			&#39;StartFrequency&#39;,       -100e3, ...9

			&#39;StopFrequency&#39;,        100e3,...

			&#39;Position&#39;,             figposition([50 30 30 40]));



			hTimeScope = dsp.TimeScope(...

			&#39;Name&#39;,                &#39;Frequency of the Sine waveform sent out&#39;,...

			&#39;Title&#39;,               &#39;Frequency of the Sine waveform sent out&#39;,...

			&#39;PlotAsMagnitudePhase&#39;, false,...

			&#39;SampleRate&#39;,           200e3, ...

			&#39;TimeSpan&#39;,             0.001,...

			&#39;YLimits&#39;,              [-0.2,0.2],...

			&#39;Position&#39;,             figposition([50 30 30 40]));



		%% 定义信号源

		hSineSource = dsp.SineWave (...

			&#39;Frequency&#39;,           31e3, ...

			&#39;Amplitude&#39;,           0.8,...

			&#39;ComplexOutput&#39;,      true, ...

			&#39;SampleRate&#39;,         200e3, ...

			&#39;SamplesPerFrame&#39;,     4000, ...

			&#39;OutputDataType&#39;,      &#39;double&#39;);



		%% 主函数，循环产生视图



		 if radioFound

			% Loop until the example reaches the target stop time.

			timeCounter = 0;

			while timeCounter &lt; 30

			  dataTx = step(hSineSource);  % Generate audio waveform

		%        step(hTimeScope,dataTx);

			  step(radioTx, dataTx);

				% Receiver stream processing

				% -----------------------------------------------------------------

			  [dataRx, lenRx] = step(radioRx);

			  if lenRx &gt; 0

				  step(hSpectrumAnalyzer, dataRx);

		%           plotspecsb(dataRx,1/200e3);

				  step(hTimeScope,dataRx);

		%             hTimeScope(dataRx);

			  end

			  timeCounter=timeCounter+0.001;

		   end

		else

			warning(message(&#39;sdru:sysobjdemos:MainLoop&#39;))

		 end



		 %% 。。。

		release(radioTx)

		release(radioRx)

		release(hSineSource)

		displayEndOfDemoMessage(mfilename)
    
    